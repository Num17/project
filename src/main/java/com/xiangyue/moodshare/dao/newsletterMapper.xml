<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiangyue.moodshare.dao.NewsletterDao">

	<sql id="Base_Column">
		nid,
		letter,
		letterimage,
		lettervedio,
		thumbsCount,
		thumbsUserId,
		createTime,
		userName,
		userImg,
		userId
	</sql>

	<resultMap type="com.xiangyue.moodshare.entity.Newsletter"
		id="Base_Map">
		<id property="nid" column="nid" />
		<result property="letter" column="letter" />
		<result property="letterimage" column="letterimage" />
		<result property="lettervedio" column="lettervedio" />
		<result property="thumbsCount" column="thumbsCount" />
		<result property="thumbsUserId" column="thumbsUserId" />
		<result property="createTime" column="createTime" />
		<result property="userName" column="userName" />
		<result property="userImg" column="userImg" />
		<result property="userId" column="userId" />
		<collection property="comments" column="nid"
			select="com.xiangyue.moodshare.dao.CommentDao.getComments" />
	</resultMap>

	<delete id="delete">
		delete from newsletter where nid=#{nid}
	</delete>

	<select id="getNewsletterList" resultMap="Base_Map">
		select
		<include refid="Base_Column" />
		from newsletter
		<if test="userId != null">
			where userId=#{userId}
		</if>
		order by nid desc
		limit #{offSet},#{pageSize}
	</select>

	<select id="getThumbsById" resultType="java.lang.String">
		select thumbsUserId
		from
		newsletter
		where nid=#{nid}
	</select>

	<insert id="insert" parameterType="com.xiangyue.moodshare.entity.Newsletter">
		insert into newsletter(
		<include refid="Base_Column" />
		)
		values(
		null,
		#{letter},
		#{letterimage},
		#{lettervedio},
		#{thumbsCount},
		#{thumbsUserId},
		#{createTime},
		#{userName},
		#{userImg},
		#{userId}
		)
	</insert>

	<update id="thumbs">
		update newsletter
		set
		thumbsUserId=#{thumbsUserId}
	</update>

	<select id="getTotal" resultType="java.lang.Integer">
		select
		count(nid)
		from
		newsletter
	</select>

</mapper>